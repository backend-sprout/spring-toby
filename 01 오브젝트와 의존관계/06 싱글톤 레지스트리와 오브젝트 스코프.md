# 싱글톤 레지스트리와 오브젝트 스코프

스프링의 애플리케이션 컨텍스트는 기존에 직접 만들었던 오브젝트 팩토리와는 중요한 차이점이이 있다.   

**오브젝트의 동일성과 동등성**
``` 
자바에서 두 오브젝트가 같안가라는 말은 주의해야하면서 써야한다.       

* 동일성 비교 : 2개의 오브젝트가 완전히 같은 동일한 오브젝트임을 나타내는 관계     
* 동등성 비교 : 2개의 오브젝트가 동일한 정보를 담고 있는 관계  

2개의 오브젝트가 동일하다면 사실은 하나의 오브젝트만 존재하는 것이고 별도의 레퍼런스 변수가 추가된 것 뿐이다.  
2개의 오브젝트가 동일하지는 않지만 동등한 경우에는 2개의 오브젝트가 각기 다른 메모리상에 존재하는 건데   
오브젝트의 동등성 기준에 따라 두 오브젝트 정보가 동등하다고 판단하는 것일 뿐이다.     
물론 동일한 오브젝트는 동등하기도 할 것이다. 하지만, 그 반대는 항상 참이 아니다.    
  
자바 클래스를 만들 때, equals() 메서드를 따로 구현하지 않았다면,        
최상위 클래스인 Object 클래스에 구현되어 있는 equals() 메서드가 사용된다.       
Object 의 equals() 메서드는 두 오브젝트의 동일성을 비교해서 그 결과를 돌려준다.    
따라서 이때는 동일한 오브젝트여야지만 동등한 오브젝트라고 여겨질 것이다.  
``` 
  
스프링은 기본적으로 싱글톤 전략을 사용한다.    
즉, 객체를 하나만 만들고 이를 계속 반환해주는 형태이다.(참조 변수만 늘어나는 것 뿐이다.)  

## 싱글톤 레지스트리로서의 애플리케이션 컨텍스트   
    
애플리케이션 컨텍스트는 IoC 컨테이너이면서 싱글톤을 저장하고 관리하는 싱글톤 레지스트리이기도 하다.     
여기서 말한 싱글톤은 디자인패턴의 싱글톤과 매우 유사하지만 그 구현방법은 확실히 다르다.    
  
### 서버 애플리케이션과 싱글톤    
    
스프링은 왜 싱글톤으로 만드는 것일까?          
**스프링이 주로 적용되는 대상이 자바 엔터프라이즈 기술을 사용하는 서버 환경이기 때문이다.**          
태생적으로 스프링은 `엔터프라이즈 시스템`을 위해 고안된 기술이기에 서버 환경에서 사용될 때 그 가치가 있다.      
      
스프링이 처음 설계되었던 대규모의 엔터프라이즈 서버 환경은 서버 하나당     
최대로 초당 수십에서 수백번씩 브라우저나 여타 시스템으로부터의 요청을 받아 처리할 수 있는 높은 성능이 요구되는 환경이었다.       
또, 하나의 요청을 처리하기 위해 데이터 액세서 로직, 서비스 로직, 비즈니스 로직, 프레젠테이션 로직 등의     
다양한 기능을 담당하는 오브젝트들이 참여하는 계층형 구조로 이뤄진 경우가 대부분이다.        
비즈니스 로직도 복잡한 경우가 많다.     

그런데 매번 클라이언트에서 요청이 올때마다 **각 로직을 담당하는 오브젝트를 새로 만들어서 사용한다고 생각해보자**          
요청 한번에 몇백개의 오브젝트가 만들어지는 것은 무리이며 **GC 성능이 좋아졌다고 한들 서버가 감당하기 힘들다.**      
   
그래서 엔터프라이즈 분야에서는 서비스 오브젝트라는 개념을 일찍부터 사용해왔다.        
서블릿은 자바 엔터프라이즈 기술의 가장 기본이 되는 서비스 오브젝트라고 할 수 있다.     
스펙에서 강제하진 않지만, 서블릿은 대부분 멀티 스레드 환경에서 싱글톤으로 동작한다.      
서블릿 클래스당 하나의 오브젝트만 만들어두고, 사용자의 요청을 담당하는 여러 스레드에서 하나의 오브젝트를 공유해 동시에 사용한다.  
  
이렇게 애플리케이션 안에 제한된 수, 대개 한 개의 오브젝트만 만들어서 사용하는 것이 싱글톤 패턴의 원리다.     
따라서 서버 환경에서는 서비스 싱글톤의 사용이 권장된다.     
하지만, 디자인 패턴에서 소개된 싱글톤 구현 방식은 까다롭고 여러 문제점이 있다.     
심지어 디자인 패턴의 싱글톤 패턴을 안티패턴이라고 부르는 사람도 있다.   




